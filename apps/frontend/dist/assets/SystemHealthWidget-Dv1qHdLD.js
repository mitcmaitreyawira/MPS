import{r as d,a7 as S,a8 as E,j as e}from"./index-JBX9P6Qg.js";const I=()=>{var x,u,g,b,N,j,p;const[y,c]=d.useState(!0),[s,v]=d.useState(null),[r,m]=d.useState(null),[o,l]=d.useState(null);if(d.useEffect(()=>{let t=!0;return(async()=>{c(!0),l(null);try{const[a,f]=await Promise.allSettled([S(),E()]);if(!t)return;a.status==="fulfilled"?v(a.value):l("Failed to load deep health"),f.status==="fulfilled"?m(f.value):m({status:"restricted",timestamp:new Date().toISOString(),issues:[]})}catch(a){if(!t)return;l((a==null?void 0:a.message)||"Failed to load system health")}finally{t&&c(!1)}})(),()=>{t=!1}},[]),y)return e.jsx("div",{className:"p-4 rounded-lg bg-gray-50 border",children:e.jsx("div",{className:"animate-pulse h-6 w-40 bg-gray-200 rounded"})});if(o)return e.jsx("div",{className:"p-4 rounded-lg bg-red-50 border border-red-200 text-red-800",children:o});const h=(x=s==null?void 0:s.database)!=null&&x.error?"degraded":"ok",i=(s==null?void 0:s.counts)||{},n=(r==null?void 0:r.issues)||[];return e.jsxs("div",{className:"p-4 rounded-lg bg-white border shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsx("h2",{className:"text-lg font-semibold",children:"System Health"}),e.jsx("span",{className:`text-xs px-2 py-1 rounded ${(s==null?void 0:s.status)==="ok"?"bg-green-100 text-green-700":"bg-amber-100 text-amber-700"}`,children:((u=s==null?void 0:s.status)==null?void 0:u.toUpperCase())||"UNKNOWN"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"p-3 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Database"}),e.jsx("div",{className:"mt-1 font-medium",children:h.toUpperCase()}),e.jsxs("div",{className:"text-xs text-gray-500",children:["readyState: ",String((g=s==null?void 0:s.database)==null?void 0:g.readyState)," | ping: ",((b=s==null?void 0:s.database)==null?void 0:b.pingMs)??"-","ms"]})]}),e.jsxs("div",{className:"p-3 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Cache"}),e.jsx("div",{className:"mt-1 font-medium",children:(N=s==null?void 0:s.cache)!=null&&N.enabled?"ENABLED":"DISABLED"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["entries: ",((j=s==null?void 0:s.cache)==null?void 0:j.entries)??"-"]})]}),e.jsxs("div",{className:"p-3 rounded border",children:[e.jsx("div",{className:"text-sm text-gray-500",children:"Integrity"}),e.jsx("div",{className:"mt-1 font-medium",children:((p=r==null?void 0:r.status)==null?void 0:p.toUpperCase())||"UNKNOWN"}),e.jsxs("div",{className:"text-xs text-gray-500",children:["issues: ",n.length]})]})]}),e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Collection counts"}),e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-2 text-sm",children:Object.keys(i).map(t=>e.jsxs("div",{className:"p-2 rounded border bg-gray-50 flex items-center justify-between",children:[e.jsx("span",{className:"text-gray-600",children:t}),e.jsx("span",{className:"font-semibold",children:typeof i[t]=="number"?i[t]:"ERR"})]},t))})]}),n.length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"font-medium mb-2",children:"Integrity issues"}),e.jsx("ul",{className:"space-y-2",children:n.slice(0,5).map((t,a)=>e.jsxs("li",{className:"p-3 rounded border bg-amber-50 border-amber-200",children:[e.jsx("div",{className:"text-sm font-semibold",children:t.type}),e.jsx("div",{className:"text-sm text-amber-800",children:t.message}),typeof t.total=="number"&&e.jsxs("div",{className:"text-xs text-amber-700",children:["total: ",t.total]})]},a))})]})]})};export{I as SystemHealthWidget};
