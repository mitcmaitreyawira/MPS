import{r as m,j as r,a6 as I,q as u}from"./index-JBX9P6Qg.js";import{g as R,a as N}from"./helpers-snl2sRJ-.js";import{u as S}from"./useDebounce-CwzWEB2R.js";const M=({users:i,selectedUserIds:e,onSelectionChange:t,placeholder:l="Search users..."})=>{const[o,a]=m.useState(""),[c,h]=m.useState(!1),f=m.useRef(null),p=m.useRef(null),x=S(o,300),v=m.useMemo(()=>i.filter(s=>e.includes(s.id)),[i,e]),g=m.useMemo(()=>{const s=x.toLowerCase();return i.filter(n=>!e.includes(n.id)&&n.name.toLowerCase().includes(s))},[i,e,x]);m.useEffect(()=>{function s(n){f.current&&!f.current.contains(n.target)&&h(!1)}return document.addEventListener("mousedown",s),()=>{document.removeEventListener("mousedown",s)}},[f]);const b=s=>{var n;t([...e,s]),a(""),(n=p.current)==null||n.focus()},A=s=>{t(e.filter(n=>n!==s))};return r.jsxs("div",{className:"relative",ref:f,children:[r.jsxs("div",{className:"flex flex-wrap gap-2 items-center p-2 border border-border rounded-lg bg-surface focus-within:ring-2 focus-within:ring-primary",onClick:()=>{var s;return(s=p.current)==null?void 0:s.focus()},children:[v.map(s=>r.jsxs("span",{className:"flex items-center gap-1.5 bg-primary/10 text-primary text-sm font-medium px-2 py-1 rounded-full",children:[s.name,r.jsx("button",{type:"button",onClick:()=>A(s.id),className:"text-primary/70 hover:text-primary",children:r.jsx(I,{className:"h-4 w-4"})})]},s.id)),r.jsx("input",{ref:p,type:"text",value:o,onChange:s=>a(s.target.value),onFocus:()=>h(!0),placeholder:e.length>0?"":l,className:"flex-grow bg-transparent outline-none text-text-primary placeholder-text-secondary/70 text-sm p-1"})]}),c&&r.jsx("ul",{className:"absolute z-20 w-full mt-1 bg-surface border border-border rounded-lg shadow-lg max-h-60 overflow-y-auto animate-fade-in-up",children:g.length>0?g.map(s=>r.jsxs("li",{className:"flex items-center p-3 cursor-pointer hover:bg-slate-100",onMouseDown:n=>{n.preventDefault(),b(s.id)},children:[r.jsx("div",{className:`w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-sm mr-3 ${N(s.name)}`,children:R(s.name)}),r.jsxs("div",{children:[r.jsx("p",{className:"font-medium text-text-primary",children:s.name}),r.jsx("p",{className:"text-xs text-text-secondary",children:s.className})]})]},s.id)):r.jsx("li",{className:"p-3 text-sm text-center text-text-secondary",children:o?"No matching users found.":"All users are selected or no users available."})})]})},E={NAME:/^[a-zA-Z\s.'-]{2,50}$/},d={REQUIRED:"This field is required",PASSWORD_MISMATCH:"Passwords do not match",NAME_INVALID:"Name must be 2-50 characters and contain only letters and spaces",CLASS_REQUIRED:"Please select a class for this user role"};class T{constructor(e=[]){this.existingUsers=e}validateUser(e,t=!1,l,o){const a=[],c=[];return this.validateRequiredFields(e,a,t),this.validateFormats(e,a),(!t||e.password)&&this.validatePassword(a,e.password,o),this.validateBusinessRules(e,a,c),{isValid:a.length===0,errors:a,warnings:c}}validateRequiredFields(e,t,l){const o=["name","role"];l||o.push("password"),(e.role===u.STUDENT||e.role===u.HEAD_OF_CLASS)&&o.push("classId"),o.forEach(a=>{const c=e[a];(!c||typeof c=="string"&&c.trim()==="")&&t.push({field:a,message:d.REQUIRED,type:"required"})})}validateFormats(e,t){e.name&&!E.NAME.test(e.name)&&t.push({field:"name",message:d.NAME_INVALID,type:"format"})}validatePassword(e,t,l){if(!t){e.push({field:"password",message:d.REQUIRED,type:"required"});return}l!==void 0&&t!==l&&e.push({field:"confirmPassword",message:d.PASSWORD_MISMATCH,type:"mismatch"})}validateBusinessRules(e,t,l){(e.role===u.STUDENT||e.role===u.HEAD_OF_CLASS)&&(!e.classId||e.classId.trim()==="")&&t.push({field:"classId",message:d.CLASS_REQUIRED,type:"business"}),e.role===u.PARENT&&(!e.childIds||e.childIds.length===0)&&l.push("Consider assigning children to this parent account for proper functionality.")}validateField(e,t,l={},o=void 0){switch(e){case"nisn":break;case"name":if(!t)return{field:"name",message:d.REQUIRED,type:"required"};if(!E.NAME.test(t))return{field:"name",message:d.NAME_INVALID,type:"format"};break;case"password":if(!t)return{field:"password",message:d.REQUIRED,type:"required"};break}return null}updateExistingUsers(e){this.existingUsers=e}}function w(i){return/^[0-9a-fA-F]{24}$/.test(i)}function U(i){if(!i||i.trim()==="")return{isValid:!1,error:"Class ID is required"};const e=i.trim();return w(e)?{isValid:!0,sanitized:e}:{isValid:!1,error:`Invalid class ID format. Expected a 24-character hexadecimal string, but received: "${e}". Class IDs must be valid MongoDB ObjectIds (e.g., "507f1f77bcf86cd799439011").`}}export{M as S,T as U,U as v};
