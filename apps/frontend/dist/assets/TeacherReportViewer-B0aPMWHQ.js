import{b as T,r as m,R as a,j as e,c as S,B as d,a as W,w as A}from"./index-JBX9P6Qg.js";import{C as D}from"./ConfirmationModal-CPL5EhPs.js";import{g as I,a as z}from"./helpers-snl2sRJ-.js";import"./Modal-NYefmAjZ.js";const y=({user:t,title:c})=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-semibold text-text-secondary mb-1",children:c}),e.jsxs("div",{className:"flex items-center space-x-3 bg-slate-100 p-2 rounded-md",children:[e.jsx("div",{className:`w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-sm ${t?z(t.name):"bg-gray-200 text-gray-800"}`,children:t?I(t.name):"?"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium text-text-primary text-sm",children:t?t.name:"Unknown User"}),e.jsx("p",{className:"text-xs text-text-secondary capitalize",children:t?t.role.replace(/_/g," "):"N/A"})]})]})]}),$=({reports:t,users:c,onUpdate:f})=>{const{reviewTeacherReport:g,updateTeacherReport:v}=T(),[i,x]=m.useState(a.NEW),[R,w]=m.useState(null),[h,p]=m.useState(null),[u,j]=m.useState({}),C=async()=>{h&&(await g(h),f(),p(null))},E=async s=>{const r=u[s];r&&r.trim()&&(await v(s,{response:r.trim()}),j(n=>({...n,[s]:""})),f())},b=t.filter(s=>i==="all"||s.status===i);return e.jsxs(e.Fragment,{children:[e.jsxs(S,{children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-xl font-semibold text-text-primary",children:"Teacher Reports"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(d,{size:"sm",onClick:()=>x("all"),variant:i==="all"?"primary":"neutral",children:["All (",t.length,")"]}),e.jsxs(d,{size:"sm",onClick:()=>x(a.NEW),variant:i===a.NEW?"primary":"neutral",children:["New (",t.filter(s=>s.status===a.NEW).length,")"]}),e.jsxs(d,{size:"sm",onClick:()=>x(a.REVIEWED),variant:i===a.REVIEWED?"primary":"neutral",children:["Reviewed (",t.filter(s=>s.status===a.REVIEWED).length,")"]})]})]}),e.jsx("div",{className:"max-h-[32rem] overflow-y-auto pr-2 space-y-4",children:b.length>0?b.map(s=>{var N;const r=c.find(l=>l.id===s.submittedByUserId),n=c.find(l=>l.id===s.targetTeacherId),o=R===s.id;return e.jsxs("div",{className:"p-4 bg-slate-50 border border-border rounded-lg",children:[e.jsxs("div",{className:"flex justify-between items-start mb-3",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-bold text-text-primary",children:["Report against: ",e.jsx("span",{className:"text-danger",children:(n==null?void 0:n.name)||"Unknown Teacher"})]}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Submitted on ",new Date(s.timestamp).toLocaleString()]})]}),e.jsxs("div",{className:"flex flex-col items-end gap-2",children:[e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${s.status===a.NEW?"bg-amber-100 text-amber-800":"bg-green-100 text-green-800"}`,children:s.status}),s.status===a.NEW&&e.jsxs(d,{size:"sm",onClick:()=>p(s.id),children:[e.jsx(W,{className:"h-4 w-4 mr-1.5"}),"Mark as Reviewed"]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 my-4",children:[e.jsx(y,{user:n,title:"Reported Teacher"}),e.jsx(y,{user:s.isAnonymous?void 0:r,title:s.isAnonymous?"Reporter (Anonymous)":"Reporter"})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("button",{onClick:()=>w(o?null:s.id),"aria-expanded":o,className:"w-full text-primary text-sm font-medium flex justify-between items-center group",children:[e.jsx("span",{children:"View Report Details"}),e.jsx(A,{className:`h-4 w-4 transform transition-transform ${o?"rotate-180":""}`})]}),o&&e.jsxs("div",{className:"animate-fade-in-up space-y-4",children:[e.jsxs("div",{className:"mt-3 pt-3 border-t border-border",children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-2",children:"Report Details:"}),e.jsx("p",{className:"text-sm text-text-primary bg-white p-3 rounded-md shadow-inner border",children:s.details})]}),s.response&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-2",children:"Admin Response:"}),e.jsx("p",{className:"text-sm text-text-primary bg-blue-50 p-3 rounded-md border border-blue-200",children:s.response})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-text-primary mb-2",children:"Send Response:"}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("textarea",{value:u[s.id]||"",onChange:l=>j(k=>({...k,[s.id]:l.target.value})),placeholder:"Type your response to this report...",className:"flex-1 min-h-[80px] px-3 py-2 border border-border rounded-md text-sm resize-none focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"}),e.jsx(d,{size:"sm",onClick:()=>E(s.id),disabled:!((N=u[s.id])!=null&&N.trim()),className:"self-end",children:"Send"})]})]})]})]})]},s.id)}):e.jsx("p",{className:"text-center text-text-secondary py-12",children:"No reports match the current filter."})})]}),e.jsx(D,{isOpen:!!h,onClose:()=>p(null),onConfirm:C,title:"Confirm Report Review",message:"Are you sure you want to mark this report as reviewed? This action is for administrative tracking and cannot be undone.",confirmText:"Mark as Reviewed",confirmVariant:"secondary"})]})};export{$ as TeacherReportViewer};
