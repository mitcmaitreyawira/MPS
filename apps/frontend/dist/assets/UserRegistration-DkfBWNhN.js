import{r as i,j as e,B as C,X as D,q as d,a as W,I as N,a9 as z,Y as G}from"./index-JBX9P6Qg.js";import{A as X,a as Y}from"./AdminDashboard-CCkNeIC3.js";import{S as E}from"./Select-BM0zQtf0.js";import{U as J,S as K,v as Q}from"./validation-CkSfakBh.js";import"./helpers-snl2sRJ-.js";import"./useDebounce-CwzWEB2R.js";const Z=({password:c})=>c?e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"flex-1 bg-green-200 rounded-full h-2",children:e.jsx("div",{className:"h-2 rounded-full bg-green-500 w-full"})}),e.jsx("span",{className:"text-sm font-medium text-green-600",children:"Accepted"})]}),e.jsx("p",{className:"text-xs text-green-600 mt-1",children:"✓ Any password is accepted - no requirements"})]}):null,F=i.memo(({users:c,classes:j,onSuccess:g})=>{const[u,f]=i.useState(!1),[I,b]=i.useState(null),[q,U]=i.useState(!1),[B,V]=i.useState(""),[s,S]=i.useState({name:"",nisn:"",password:"",role:d.STUDENT,classId:"",childIds:[],gender:""}),[k,T]=i.useState(""),[r,p]=i.useState({}),[R,y]=i.useState([]),[v]=i.useState(()=>new J(c));i.useEffect(()=>{v.updateExistingUsers(c)},[c,v]);const _=(a,t)=>{let l=v.validateField(a,t,s);if(a==="classId"&&t&&t.trim()!==""){const n=Q(t);n.isValid||(l={message:n.error||"Invalid class ID format"})}p(n=>{const m={...n};return l?m[a]=l:delete m[a],m})},L=i.useMemo(()=>c.filter(a=>a.role===d.STUDENT&&!a.isArchived),[c]),h=a=>{const{name:t,value:l}=a.target,n={...s,[t]:l};t==="role"&&(l!==d.PARENT&&(n.childIds=[]),l!==d.STUDENT&&l!==d.HEAD_OF_CLASS&&(n.classId="")),S(n),setTimeout(()=>_(t,l),0)},A=a=>{const{name:t,value:l}=a.target;t==="confirmPassword"?(T(l),setTimeout(()=>{s.password&&l&&s.password!==l?p(n=>({...n,confirmPassword:{field:"confirmPassword",message:"Passwords do not match",type:"mismatch"}})):p(n=>{const m={...n};return delete m.confirmPassword,m})},0)):h(a)},H=a=>{S({...s,childIds:a})},O=async a=>{var l,n,m,P;a.preventDefault(),b(null),y([]);const t=v.validateUser(s,!1,void 0,k);if(!t.isValid){const o=t.errors.map(x=>`${x.field}: ${x.message}`).join(`
`);b(`❌ Validation Failed

${o}

Please correct the errors above and try again.`);const w={};t.errors.forEach(x=>{w[x.field]=x}),p(w);return}t.warnings.length>0&&y(t.warnings),f(!0);try{const o={name:s.name,nisn:s.nisn,password:s.password,role:s.role,roles:s.role?[s.role]:[],classId:s.classId,childIds:s.childIds,gender:s.gender};await z(o),V(`${(l=s.role)==null?void 0:l.replace(/_/g," ").toLowerCase()} user created successfully.`),U(!0),setTimeout(()=>{S({name:"",nisn:"",password:"",role:d.STUDENT,classId:"",childIds:[],gender:""}),T(""),p({}),y([]),U(!1),g()},2e3)}catch(o){console.error("Error creating user:",o);const w=await G.handleError(o,{operation:"createUser",context:"UserRegistration",formData:{...s,password:"[REDACTED]"}});if(((n=o.response)==null?void 0:n.status)===409){const x=((P=(m=o.response)==null?void 0:m.data)==null?void 0:P.message)||o.message||"A user with this information already exists";x.toLowerCase().includes("nisn")?p($=>({...$,nisn:{field:"nisn",message:"This NISN is already registered",type:"duplicate"}})):b(x)}else b(w.userMessage||o.message||"Failed to create user")}finally{f(!1)}};return q?e.jsxs("div",{className:"text-center p-6 animate-fade-in",children:[e.jsx("div",{className:"animate-bounce",children:e.jsx(W,{className:"mx-auto h-16 w-16 text-green-500"})}),e.jsx("h3",{className:"mt-4 text-xl font-semibold text-text-primary",children:"Success!"}),e.jsx("p",{className:"mt-3 text-base text-text-secondary",children:B}),e.jsx("div",{className:"mt-6 space-y-2",children:e.jsx("div",{className:"text-sm text-green-600 bg-green-50 rounded-lg p-3",children:"✅ User has been created successfully"})})]}):e.jsxs("form",{onSubmit:O,className:"space-y-4",children:[R.length>0&&e.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-3",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-yellow-400",children:"⚠️"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-yellow-800",children:"Validation Warnings"}),e.jsx("div",{className:"mt-2 text-sm text-yellow-700",children:e.jsx("ul",{className:"list-disc pl-5 space-y-1",children:R.map((a,t)=>e.jsx("li",{children:a.message},t))})})]})]})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Full Name"}),e.jsx(N,{name:"name",value:s.name,onChange:h,placeholder:"Enter full name",required:!0,className:r.name?"border-red-500":""}),r.name&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.name.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"NISN / User ID"}),e.jsx(N,{name:"nisn",value:s.nisn,onChange:h,placeholder:"Enter NISN or unique user ID",required:!0,className:r.nisn?"border-red-500":""}),r.nisn&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.nisn.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Gender"}),e.jsxs(E,{name:"gender",value:s.gender||"",onChange:h,className:r.gender?"border-red-500":"",children:[e.jsx("option",{value:"",children:"Select gender..."}),e.jsx("option",{value:"male",children:"Male"}),e.jsx("option",{value:"female",children:"Female"})]}),r.gender&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.gender.message})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"User Role"}),e.jsx(E,{name:"role",value:s.role,onChange:h,className:r.role?"border-red-500":"",children:Object.values(d).map(a=>e.jsx("option",{value:a,children:a.replace(/_/g," ").replace(/\b\w/g,t=>t.toUpperCase())},a))}),r.role&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.role.message})]}),(s.role===d.TEACHER||s.role===d.HEAD_OF_CLASS)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Subject(s)"}),e.jsx(N,{name:"subject",value:s.subject||"",onChange:h,placeholder:"e.g., Mathematics, Science, English",className:r.subject?"border-red-500":""}),r.subject&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.subject.message}),e.jsx("p",{className:"mt-1 text-xs text-text-secondary",children:"Enter the subject(s) this teacher teaches, separated by commas"})]}),(s.role===d.STUDENT||s.role===d.HEAD_OF_CLASS)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Assign Class"}),e.jsxs(E,{name:"classId",value:s.classId||"",onChange:h,required:!0,children:[e.jsx("option",{value:"",children:"Select a class..."}),j.map(a=>e.jsx("option",{value:a.id,children:a.name},a.id))]})]}),s.role===d.PARENT&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Assign Children"}),e.jsx(K,{users:L,selectedUserIds:s.childIds||[],onSelectionChange:H,placeholder:"Search and add children..."})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Set Password"}),e.jsx(N,{type:"password",name:"password",value:s.password,onChange:A,placeholder:"Enter a secure password...",required:!0,className:r.password?"border-red-500":""}),r.password&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.password.message}),e.jsx(Z,{password:s.password||""})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-text-secondary mb-1",children:"Confirm Password"}),e.jsx(N,{type:"password",name:"confirmPassword",value:k,onChange:A,placeholder:"Re-enter the password...",required:!0,className:r.confirmPassword?"border-red-500":""}),r.confirmPassword&&e.jsx("p",{className:"mt-1 text-sm text-red-600",children:r.confirmPassword.message})]})]}),I&&e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-md p-4 animate-shake",children:e.jsxs("div",{className:"flex",children:[e.jsx("div",{className:"flex-shrink-0",children:e.jsx("span",{className:"text-red-400",children:"❌"})}),e.jsxs("div",{className:"ml-3",children:[e.jsx("h3",{className:"text-sm font-medium text-red-800",children:"Error"}),e.jsx("div",{className:"mt-2 text-sm text-red-700 whitespace-pre-line",children:I})]})]})}),e.jsx(C,{type:"submit",className:"w-full !mt-6",disabled:u,children:u?e.jsxs("div",{className:"flex items-center justify-center space-x-2",children:[e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}),e.jsx("span",{children:"Creating User..."})]}):"Create User"})]})}),M=i.memo(({users:c,classes:j,onSuccess:g})=>e.jsxs("div",{className:"text-center p-8 bg-slate-50 rounded-lg border-2 border-dashed border-slate-300",children:[e.jsx(D,{className:"mx-auto h-12 w-12 text-slate-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-slate-600 mb-2",children:"Bulk Registration"}),e.jsx("p",{className:"text-slate-500 mb-4",children:"Bulk user registration functionality will be implemented in the next phase."}),e.jsx("p",{className:"text-sm text-slate-400",children:"This will support CSV import/export and mass user creation."})]})),ee=i.memo(({users:c,classes:j,onUpdate:g})=>{const[u,f]=i.useState("single");return e.jsx(X,{title:"User Registration",description:"Register new users with comprehensive role support and validation",icon:e.jsx(D,{className:"h-6 w-6"}),actions:e.jsx(Y,{children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(C,{variant:u==="single"?"primary":"secondary",size:"sm",onClick:()=>f("single"),children:"Single User"}),e.jsx(C,{variant:u==="bulk"?"primary":"secondary",size:"sm",onClick:()=>f("bulk"),children:"Bulk Registration"})]})}),children:e.jsx("div",{className:"max-w-2xl mx-auto",children:u==="single"?e.jsx(F,{users:c,classes:j,onSuccess:g}):e.jsx(M,{users:c,classes:j,onSuccess:g})})})});F.displayName="SingleUserRegistrationForm";M.displayName="BulkUserRegistrationForm";ee.displayName="UserRegistration";export{ee as default};
