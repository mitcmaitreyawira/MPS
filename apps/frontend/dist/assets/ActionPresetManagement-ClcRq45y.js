import{b as M,r as o,j as e,s as m,B as A,Z as w,w as E,$ as O,a0 as k,a as L,a1 as R,I as N,t as P}from"./index-JBX9P6Qg.js";import{A as B}from"./AdminDashboard-CCkNeIC3.js";import{M as q}from"./Modal-NYefmAjZ.js";import{T as z}from"./Table-DlSKKgO4.js";import{S as C}from"./Select-BM0zQtf0.js";import{B as F}from"./BadgeIconRenderer-BjlOxHvs.js";import{C as $}from"./ConfirmationModal-CPL5EhPs.js";const V=({preset:a,onDone:r})=>{const{createActionPreset:f,updateActionPreset:y}=M(),[c,x]=o.useState(!1),[n,l]=o.useState(null),[h,p]=o.useState(!1),[j,v]=o.useState(""),[t,u]=o.useState({name:(a==null?void 0:a.name)||"",type:(a==null?void 0:a.type)||m.REWARD,points:(a==null?void 0:a.points)||0,category:(a==null?void 0:a.category)||"",description:(a==null?void 0:a.description)||"",badgeTier:(a==null?void 0:a.badgeTier)||void 0,icon:(a==null?void 0:a.icon)||void 0,isArchived:(a==null?void 0:a.isArchived)||!1}),i=s=>{const{name:g,value:b,type:T}=s.target,d={...t};T==="checkbox"?d.isArchived=s.target.checked:g==="points"?d.points=Number(b):d[g]=b,g==="type"&&b!==m.MEDAL&&(delete d.badgeTier,delete d.icon),g==="type"&&b===m.MEDAL&&(d.badgeTier=d.badgeTier||P.BRONZE),g==="icon"&&b===""&&delete d.icon,u(d)},S=async s=>{s.preventDefault(),x(!0),l(null);try{a?(await y(a.id,t),v("Preset updated successfully.")):(await f(t),v("Preset created successfully.")),p(!0)}catch(g){l(g.message)}finally{x(!1)}};if(h)return e.jsxs("div",{className:"text-center p-4",children:[e.jsx(L,{className:"mx-auto h-12 w-12 text-secondary"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-text-primary",children:"Success!"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:j}),e.jsx(A,{onClick:r,className:"mt-6",variant:"secondary",children:"Close"})]});const I=R.map(s=>({name:s.charAt(0).toUpperCase()+s.slice(1).replace(/([A-Z])/g," $1"),value:s}));return e.jsxs("form",{onSubmit:S,className:"space-y-4",children:[e.jsx(N,{name:"name",value:t.name,onChange:i,placeholder:"Preset Name (e.g., '+10 for Homework')",required:!0}),e.jsx(C,{name:"type",value:t.type,onChange:i,children:Object.values(m).map(s=>e.jsx("option",{value:s,className:"capitalize",children:s},s))}),e.jsx(N,{name:"points",type:"number",value:t.points,onChange:i,placeholder:"Points (e.g., 10 or -5)",required:!0}),e.jsx(N,{name:"category",value:t.category,onChange:i,placeholder:"Category (e.g., 'Homework')",required:!0}),e.jsx(N,{name:"description",value:t.description,onChange:i,placeholder:"Default Description",required:!0}),t.type===m.MEDAL&&e.jsxs(e.Fragment,{children:[e.jsx(C,{name:"badgeTier",value:t.badgeTier,onChange:i,required:!0,children:Object.values(P).map(s=>e.jsx("option",{value:s,className:"capitalize",children:s},s))}),e.jsxs(C,{name:"icon",value:t.icon||"",onChange:i,children:[e.jsx("option",{value:"",children:"Default Medal Icon"}),I.map(s=>e.jsx("option",{value:s.value,children:s.name},s.value))]})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer text-text-secondary",children:[e.jsx("input",{type:"checkbox",name:"isArchived",checked:t.isArchived,onChange:i,className:"h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Is Archived"})]}),n&&e.jsx("p",{className:"text-sm text-danger",children:n}),e.jsx(A,{type:"submit",className:"w-full !mt-6",disabled:c,children:c?a?"Updating...":"Creating...":a?"Update Preset":"Create Preset"})]})},D=({title:a,presets:r,onEdit:f,onDelete:y})=>{const[c,x]=o.useState(!0);return r.length===0?null:e.jsxs("div",{className:"border border-border rounded-lg",children:[e.jsx("div",{className:"p-4 bg-slate-50/70 border-b border-border cursor-pointer",onClick:()=>x(!c),children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("h4",{className:"font-semibold text-text-primary capitalize",children:[a," (",r.length,")"]}),e.jsx(E,{className:`h-5 w-5 text-text-secondary transition-transform ${c?"rotate-180":""}`})]})}),c&&e.jsx("div",{className:"overflow-x-auto",children:e.jsx(z,{headers:["Name","Points","Category","Status","Actions"],children:r.map(n=>e.jsxs("tr",{children:[e.jsxs("td",{className:"px-6 py-3 font-medium text-text-primary flex items-center gap-2",children:[n.type===m.MEDAL&&n.badgeTier&&e.jsx(F,{badge:{tier:n.badgeTier,icon:n.icon},className:"h-5 w-5"}),n.name]}),e.jsx("td",{className:`px-6 py-3 font-bold ${n.points>=0?"text-secondary":"text-danger"}`,children:n.points}),e.jsx("td",{className:"px-6 py-3",children:n.category}),e.jsx("td",{className:"px-6 py-3",children:e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full ${n.isArchived?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:n.isArchived?"Archived":"Active"})}),e.jsx("td",{className:"px-6 py-3",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(A,{size:"sm",variant:"secondary",onClick:()=>f(n),children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx(A,{size:"sm",variant:"danger",onClick:()=>y(n),children:e.jsx(k,{className:"h-4 w-4"})})]})})]},n.id))})})]})},Q=({onUpdate:a})=>{const{actionPresets:r,deleteActionPreset:f}=M(),[y,c]=o.useState(!1),[x,n]=o.useState(void 0),[l,h]=o.useState(null),p=o.useMemo(()=>Array.isArray(r)?r.reduce((u,i)=>(u[i.type]=u[i.type]||[],u[i.type].push(i),u),{}):{},[r]),j=u=>{n(u),c(!0)},v=()=>{n(void 0),c(!1),a()},t=async()=>{l&&(await f(l.id),a(),h(null))};return e.jsxs(e.Fragment,{children:[e.jsx(B,{title:"Action Presets",description:"Manage predefined actions for rewards, violations, and medals",icon:e.jsx(w,{}),actions:[e.jsxs(A,{onClick:()=>j(),children:[e.jsx(w,{className:"h-5 w-5 mr-2"}),"Add Preset"]},"add")],children:e.jsxs("div",{className:"space-y-4 max-h-[32rem] overflow-y-auto pr-2",children:[e.jsx(D,{title:"Rewards",presets:p[m.REWARD]||[],onEdit:j,onDelete:h}),e.jsx(D,{title:"Violations",presets:p[m.VIOLATION]||[],onEdit:j,onDelete:h}),e.jsx(D,{title:"Medals",presets:p[m.MEDAL]||[],onEdit:j,onDelete:h})]})}),e.jsx(q,{isOpen:y,onClose:v,title:x?"Edit Action Preset":"Create New Action Preset",children:e.jsx(V,{preset:x,onDone:v})}),e.jsx($,{isOpen:!!l,onClose:()=>h(null),onConfirm:t,title:"Confirm Deletion",message:e.jsxs("p",{children:['Are you sure you want to delete the preset "',e.jsx("strong",{children:l==null?void 0:l.name}),'"? This action cannot be undone.']}),confirmText:"Confirm Delete",confirmVariant:"danger"})]})};export{Q as default};
