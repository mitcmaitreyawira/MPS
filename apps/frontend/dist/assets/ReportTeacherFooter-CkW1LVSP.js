import{j as e,r as m,q as y,O as k,T as D,u as L,P as N,A as S,B as b,a as E,v as P,t as O,k as B,i as M,p as g,m as T,M as C,V as $,G as U,b as V}from"./index-JBX9P6Qg.js";import{g as F,a as _}from"./helpers-snl2sRJ-.js";import{B as R}from"./BadgeIconRenderer-BjlOxHvs.js";import{M as H}from"./Modal-NYefmAjZ.js";import{S as G}from"./SearchableSingleUserSelector-DWlEu3dp.js";const z=({points:s,goal:c=100,size:n=200,strokeWidth:d=15,className:o})=>{const h=Math.min(s/c*100,100),l=(n-d)/2,i=2*Math.PI*l,t=i-h/100*i,f=s<70?"text-danger":s<80?"text-warning":"text-secondary";return e.jsxs("svg",{width:n,height:n,viewBox:`0 0 ${n} ${n}`,className:o,style:{transform:"rotate(-90deg)"},children:[e.jsx("circle",{className:"text-blue-200",stroke:"currentColor",fill:"transparent",strokeWidth:d,r:l,cx:n/2,cy:n/2}),e.jsx("circle",{className:f,stroke:"currentColor",fill:"transparent",strokeWidth:d,strokeLinecap:"round",r:l,cx:n/2,cy:n/2,style:{strokeDasharray:i,strokeDashoffset:t,transition:"stroke-dashoffset 0.5s ease-in-out, stroke 0.5s ease-in-out"}})]})},q=({teacher:s,children:c})=>{const[n,d]=m.useState(!1),o=m.useRef(null);if(s.role===y.STUDENT||s.role===y.ADMIN||s.role===y.SUPER_SECRET_ADMIN)return e.jsx(e.Fragment,{children:c});m.useEffect(()=>{const l=i=>{o.current&&!o.current.contains(i.target)&&d(!1)};return document.addEventListener("mousedown",l),()=>{document.removeEventListener("mousedown",l)}},[]);const h=l=>{l.stopPropagation(),d(i=>!i)};return e.jsxs("div",{className:"relative inline-block",ref:o,children:[e.jsx("div",{onClick:h,className:"cursor-pointer",children:c}),n&&e.jsxs("div",{className:"absolute z-30 w-64 p-4 mt-2 bg-surface rounded-xl shadow-lg border border-border animate-fade-in-up",style:{bottom:"100%",left:"50%",transform:"translateX(-50%)",marginBottom:"0.5rem"},children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-3 pb-3 border-b border-border",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-lg ${_(s.name)}`,children:F(s.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-text-primary",children:s.name}),e.jsx("p",{className:"text-xs text-text-secondary capitalize",children:s.role.replace(/_/g," ")})]})]}),e.jsxs("div",{className:"space-y-2 text-sm text-text-secondary",children:[s.subject&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(k,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:s.subject})]}),s.contactNumber&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:s.contactNumber})]}),!s.subject&&!s.contactNumber&&e.jsx("p",{className:"text-xs italic",children:"No additional details provided."})]})]})]})},A=10,Z=({status:s})=>{const c={[S.PENDING]:"bg-amber-100 text-amber-800",[S.APPROVED]:"bg-green-100 text-green-800",[S.REJECTED]:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize ${c[s]}`,children:s})},ee=({points:s,users:c,onAppealRequest:n,appeals:d=[]})=>{const{user:o}=L(),[h,l]=m.useState(A),i=()=>{l(s.length)},t=()=>{l(A)},p=r=>{const a="w-10 h-10 rounded-full flex items-center justify-center flex-shrink-0";switch(r){case N.REWARD:return e.jsx("div",{className:`${a} bg-secondary/10 text-secondary`,children:e.jsx(M,{className:"h-6 w-6"})});case N.VIOLATION:return e.jsx("div",{className:`${a} bg-danger/10 text-danger`,children:e.jsx(B,{className:"h-6 w-6"})});case N.QUEST:return e.jsx("div",{className:`${a} bg-accent/10 text-accent`,children:e.jsx(R,{badge:{tier:O.GOLD,icon:"star"},className:"h-6 w-6"})});case N.APPEAL_REVERSAL:return e.jsx("div",{className:`${a} bg-slate-100 dark:bg-slate-700 text-slate-600 dark:text-slate-400`,children:e.jsx(P,{className:"h-6 w-6"})});case N.OVERRIDE:return e.jsx("div",{className:`${a} bg-slate-200 text-slate-600`,children:e.jsx(E,{className:"h-6 w-6"})});default:return e.jsx("div",{className:`${a} bg-slate-200 text-slate-600`,children:e.jsx(E,{className:"h-6 w-6"})})}};if(s.length===0)return e.jsx("p",{className:"text-text-secondary text-center py-8",children:"No activity yet."});const f=[...s].sort((r,a)=>new Date(a.timestamp).getTime()-new Date(r.timestamp).getTime());return e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto pr-2",children:f.slice(0,h).map(r=>{const a=c.find(v=>v.id===r.addedBy),x=d.find(v=>v.pointLogId===r.id),I=n&&r.type===N.VIOLATION&&(o==null?void 0:o.role)===y.STUDENT&&!x,j=(x==null?void 0:x.status)===S.APPROVED;return e.jsxs("div",{className:"flex items-start space-x-4",children:[r.badge?e.jsx("div",{className:"w-10 h-10 flex items-center justify-center",children:e.jsx(R,{badge:r.badge,className:"h-8 w-8"})}):p(r.type),e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:`text-sm text-text-primary font-medium ${j?"line-through text-slate-400":""}`,children:r.description}),e.jsxs("div",{className:"text-xs text-text-secondary flex items-center gap-2 flex-wrap",children:[e.jsx("span",{children:new Date(r.timestamp).toLocaleDateString()}),r.addedBy&&e.jsx("span",{children:"by"}),a?e.jsx(q,{teacher:a,children:e.jsx("span",{className:"text-primary font-medium cursor-pointer hover:underline",children:a.name})}):r.addedBy?e.jsx("span",{className:"text-text-secondary italic",children:"[Deleted User]"}):null,I&&e.jsx(b,{size:"sm",className:"px-1.5 py-0.5 !text-xs bg-slate-200 text-slate-700 hover:bg-slate-300",onClick:()=>n(r.id),children:"Appeal"}),x&&e.jsx(Z,{status:x.status})]})]}),e.jsx("div",{className:`text-lg font-bold flex-shrink-0 ${r.points>0?"text-secondary":"text-danger"} ${j?"line-through text-slate-400":""}`,children:r.points>0?`+${r.points}`:r.points})]},r.id)})}),s.length>A&&e.jsx("div",{className:"text-center pt-4 border-t border-border",children:h<s.length?e.jsxs(b,{variant:"neutral",onClick:i,children:["Show All (",s.length,") Activities"]}):e.jsx(b,{variant:"neutral",onClick:t,children:"Show Less"})})]})},se=({awards:s})=>{const[c,n]=m.useState(null),d={[g.BRONZE]:{bg:"bg-gradient-to-br from-amber-600 to-amber-800",iconColor:"text-white/90",hover:"hover:brightness-110"},[g.SILVER]:{bg:"bg-gradient-to-br from-slate-400 to-slate-600",iconColor:"text-white/90",hover:"hover:brightness-110"},[g.GOLD]:{bg:"bg-gradient-to-br from-yellow-400 to-amber-500",iconColor:"text-white/90",hover:"hover:brightness-110"},[g.PLATINUM]:{bg:"bg-gradient-to-br from-purple-500 to-purple-700",iconColor:"text-white/90",hover:"hover:brightness-110"}},o=t=>{n(t)},h=()=>{n(null)},l=t=>{n(c===t?null:t)},i=t=>{if(t.icon&&t.icon.trim()!=="")return e.jsx("span",{className:"text-2xl",style:{fontSize:"2.25rem",lineHeight:"1"},children:t.icon});switch(t.tier){case g.GOLD:return e.jsx(T,{className:"h-9 w-9"});case g.SILVER:return e.jsx(C,{className:"h-9 w-9"});case g.BRONZE:return e.jsx(C,{className:"h-9 w-9"});case g.PLATINUM:return e.jsx($,{className:"h-9 w-9"});default:return e.jsx(C,{className:"h-9 w-9"})}};return e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("h3",{className:"text-lg font-semibold text-pink-800 flex items-center gap-2",children:[e.jsx(T,{className:"h-5 w-5"}),"Hall of Fame"]}),e.jsxs("span",{className:"text-sm text-pink-600",children:[s.length," Total Awards"]})]}),e.jsx("div",{className:"grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 xl:grid-cols-8 gap-4 auto-rows-max",children:s.map(t=>{const p=d[t.tier],f=c===t.id;return e.jsxs("div",{className:"relative flex flex-col items-center",children:[e.jsxs("div",{className:"relative",children:[e.jsx("div",{onMouseEnter:()=>o(t.id),onMouseLeave:h,onClick:()=>l(t.id),className:`w-16 h-16 rounded-full flex items-center justify-center cursor-pointer transition-all duration-300 ease-out hover:scale-125 hover:shadow-2xl hover:-translate-y-2 hover:rotate-3 ${p.bg} ${p.iconColor} ${p.hover}`,children:i(t)}),f&&e.jsxs("div",{className:"absolute top-0 mt-2 left-1/2 -translate-x-1/2 w-max max-w-xs px-4 py-3 bg-white border border-gray-200 shadow-lg rounded-lg z-10 animate-fade-in-up",children:[e.jsx("p",{className:"font-bold text-gray-900",children:t.name}),e.jsx("p",{className:"text-gray-600 mt-1 text-sm",children:t.description}),e.jsxs("p",{className:"text-gray-500 text-xs mt-2",children:[t.tier.charAt(0).toUpperCase()+t.tier.slice(1)," â€¢ ",new Date(t.awardedOn).toLocaleDateString()]}),t.awardedByName&&e.jsxs("p",{className:"text-gray-500 text-xs",children:["Awarded by ",t.awardedByName]})]})]}),e.jsx("div",{className:"mt-2 text-center",children:e.jsx("p",{className:"text-xs font-medium text-pink-700 truncate max-w-[80px]",title:t.name,children:t.name})})]},t.id)})})]})},J=({isOpen:s,onClose:c})=>{const{users:n,submitTeacherReport:d}=V(),[o,h]=m.useState(""),[l,i]=m.useState(""),[t,p]=m.useState(!1),[f,r]=m.useState(!1),[a,x]=m.useState(null),I=m.useMemo(()=>n.filter(u=>Array.isArray(u.roles)?u.roles.some(w=>w==="teacher"||w==="head_teacher"||w==="head_of_class"):u.role?u.role===y.TEACHER||u.role===y.HEAD_OF_CLASS:!1),[n]),j=()=>{h(""),i(""),p(!1),r(!1),x(null),c()},v=async u=>{if(u.preventDefault(),!f){if(x(null),!o||!l){x({type:"error",message:"Please select a teacher and provide details."});return}r(!0);try{await d({targetTeacherId:o,details:l,isAnonymous:t}),x({type:"success",message:"Report submitted successfully."})}catch(w){x({type:"error",message:w.message}),r(!1)}}};return e.jsx(H,{isOpen:s,onClose:j,title:(a==null?void 0:a.type)==="success"?"Success":"Report an Issue",children:(a==null?void 0:a.type)==="success"?e.jsxs("div",{className:"text-center py-4",children:[e.jsx(E,{className:"mx-auto h-12 w-12 text-secondary"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-text-primary",children:"Report Submitted"}),e.jsx("p",{className:"mt-2 text-sm text-text-secondary",children:a.message}),e.jsx(b,{onClick:j,className:"mt-6",variant:"secondary",children:"Close"})]}):e.jsxs("form",{onSubmit:v,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"teacher",className:"block text-sm font-medium text-text-secondary mb-1",children:"Teacher to Report"}),e.jsx(G,{users:I,selectedUserId:o,onSelectUser:h,placeholder:"Search for a teacher...",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"details",className:"block text-sm font-medium text-text-secondary mb-1",children:"Details of the Incident"}),e.jsx("textarea",{id:"details",value:l,onChange:u=>i(u.target.value),required:!0,rows:5,className:"shadow-sm appearance-none border border-border rounded-lg w-full py-2 px-3 bg-surface text-text-primary placeholder-text-secondary/70 leading-tight focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",placeholder:"Please provide a clear and detailed description of the event. Include date, time, and location if possible."})]}),e.jsxs("label",{className:"flex items-center space-x-3 cursor-pointer text-text-secondary",children:[e.jsx("input",{type:"checkbox",name:"isAnonymous",checked:t,onChange:u=>p(u.target.checked),className:"h-4 w-4 rounded border-slate-300 text-primary focus:ring-primary"}),e.jsx("span",{children:"Submit Anonymously"})]}),t&&e.jsx("p",{className:"text-xs text-amber-700 bg-amber-100 p-2 rounded-md",children:"If you submit anonymously, we cannot contact you for follow-up questions. Please be as detailed as possible."}),(a==null?void 0:a.type)==="error"&&e.jsx("div",{className:"mt-4 text-sm p-3 rounded-lg bg-red-100 text-red-800",children:a.message}),e.jsxs("div",{className:"pt-4 flex justify-end space-x-2",children:[e.jsx(b,{type:"button",variant:"neutral",onClick:j,children:"Cancel"}),e.jsx(b,{type:"submit",disabled:f,children:f?"Submitting...":"Submit Report"})]})]})})},te=()=>{const[s,c]=m.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx("footer",{className:"py-8 mt-8 border-t border-border",children:e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center gap-4",children:[e.jsxs("div",{className:"max-w-xl",children:[e.jsx("h4",{className:"font-semibold text-text-primary",children:"Confidential Reporting Channel"}),e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:"For serious concerns only. Your report will be sent directly to an administrator for review. Please use this feature responsibly."})]}),e.jsxs(b,{onClick:()=>c(!0),variant:"danger-ghost",className:"flex-shrink-0",children:[e.jsx(U,{className:"h-4 w-4 mr-2"}),"Report an Issue"]})]})}),e.jsx(J,{isOpen:s,onClose:()=>c(!1)})]})};export{ee as A,z as C,se as H,te as R};
