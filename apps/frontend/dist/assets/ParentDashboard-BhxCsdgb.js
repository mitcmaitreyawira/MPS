import{u as C,b as I,r as n,L as D,j as e,e as P,c as j,z as S,t as v,P as T,N as M,m as A,i as L,k as E,M as k,a as F,S as R,E as O}from"./index-JBX9P6Qg.js";import{S as V}from"./Select-BM0zQtf0.js";import{R as G,C as W,H as B,A as H}from"./ReportTeacherFooter-CkW1LVSP.js";import"./helpers-snl2sRJ-.js";import"./BadgeIconRenderer-BjlOxHvs.js";import"./Modal-NYefmAjZ.js";import"./SearchableSingleUserSelector-DWlEu3dp.js";import"./useDebounce-CwzWEB2R.js";const U=({student:l,allPoints:u,allUsers:r})=>{const s=n.useMemo(()=>u.filter(a=>a.studentId===l.id),[u,l.id]),f=n.useMemo(()=>Math.max(0,s.reduce((a,d)=>a+d.points,0)),[s]),c=Math.min(100,f),{accountStatus:g,statusColor:N,statusIcon:o,pointsGained:y,pointsLost:b}=n.useMemo(()=>{const a=s.filter(m=>m.points>0).reduce((m,w)=>m+w.points,0),d=Math.abs(s.filter(m=>m.points<0).reduce((m,w)=>m+w.points,0));let i="Safe",x="text-secondary",p=e.jsx(F,{className:"w-5 h-5"});return c<70?(i="At Risk",x="text-danger",p=e.jsx(R,{className:"w-5 h-5"})):c<80&&(i="Warning",x="text-warning",p=e.jsx(O,{className:"w-5 h-5"})),{accountStatus:i,statusColor:x,statusIcon:p,pointsGained:a,pointsLost:d}},[s,c]),h=n.useMemo(()=>s.filter(a=>a.badge).sort((a,d)=>{const i={[v.GOLD]:0,[v.SILVER]:1,[v.BRONZE]:2};return i[a.badge.tier]-i[d.badge.tier]}),[s]),t=n.useMemo(()=>{const a=s.filter(x=>x.type===T.VIOLATION).sort((x,p)=>new Date(p.timestamp).getTime()-new Date(x.timestamp).getTime());if(a.length===0)return 999;const d=new Date(a[0].timestamp),i=Math.abs(new Date().getTime()-d.getTime());return Math.floor(i/(1e3*60*60*24))},[s]);return e.jsxs("div",{className:"space-y-8 animate-fade-in-up",children:[e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8 items-start",children:[e.jsxs(j,{className:"lg:col-span-1 p-6 space-y-4",children:[e.jsxs("div",{className:"text-center mb-4",children:[e.jsxs("h2",{className:"text-2xl font-bold text-text-primary",children:[l.name,"'s Progress"]}),e.jsx("p",{className:"text-md text-text-secondary mt-1",children:l.className})]}),e.jsxs("div",{className:"relative w-max mx-auto",children:[e.jsx(W,{goal:100,points:c,size:220,strokeWidth:20}),e.jsxs("div",{className:"absolute inset-0 flex flex-col items-center justify-center text-center",children:[e.jsx("span",{className:"text-6xl font-bold text-text-primary",children:f}),e.jsx("span",{className:"text-md text-text-secondary mb-2",children:"Points"}),e.jsxs("div",{className:`flex items-center space-x-2 ${N}`,children:[o,e.jsx("span",{className:"font-semibold text-lg",children:g})]})]})]}),e.jsxs("div",{className:"flex justify-between items-center pt-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-text-secondary",children:[e.jsx(M,{className:"h-6 w-6 text-amber-500"}),e.jsx("span",{className:"font-bold text-lg text-text-primary",children:t===999?"Perfect":t}),e.jsx("span",{children:"Streak"})]}),e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-text-secondary",children:[e.jsx(A,{className:"h-6 w-6 text-accent"}),e.jsx("span",{className:"font-bold text-lg text-text-primary",children:h.length}),e.jsx("span",{children:"Total Awards"})]})]})]}),e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[e.jsx(j,{children:e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-4 text-center",children:[e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg",children:[e.jsx(L,{className:"h-8 w-8 text-secondary mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-bold text-text-primary",children:["+",y]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Points Gained (All Time)"})]}),e.jsxs("div",{className:"p-4 bg-slate-50 rounded-lg",children:[e.jsx(E,{className:"h-8 w-8 text-danger mx-auto mb-2"}),e.jsxs("p",{className:"text-2xl font-bold text-text-primary",children:["-",b]}),e.jsx("p",{className:"text-sm text-text-secondary",children:"Points Lost (All Time)"})]})]})}),e.jsx(j,{title:"Hall of Fame",icon:e.jsx(k,{className:"w-5 h-5"}),children:h.length>0?e.jsx(B,{pointLogsWithBadges:h}):e.jsx("p",{className:"text-text-secondary text-center py-4",children:"No badges earned yet."})})]})]}),e.jsx(j,{title:"Recent Activity",children:e.jsx(H,{points:s,users:r})})]})},X=()=>{const{user:l}=C(),{selectedYear:u}=I(),[r,s]=n.useState(null),[f,c]=n.useState(!0),[g,N]=n.useState(null),[o,y]=n.useState(null),b=n.useCallback(async()=>{c(!0),N(null);try{const t=await D({year:u});s(t),t.children.length>0&&!o&&y(t.children[0].id)}catch(t){N("Failed to load your children's data."),console.error(t)}finally{c(!1)}},[u,o]);n.useEffect(()=>{l&&b()},[l,b]);const h=n.useMemo(()=>r?r.children.find(t=>t.id===o):null,[r,o]);return f?e.jsx(P,{}):g?e.jsx("div",{className:"text-center text-danger",children:g}):!l||!r?null:e.jsxs("div",{className:"space-y-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary",children:"Parent Dashboard"}),r.children.length>1&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("label",{htmlFor:"child-select",className:"text-sm font-medium text-text-secondary",children:"Viewing:"}),e.jsx(V,{id:"child-select",value:o||"",onChange:t=>y(t.target.value),children:r.children.map(t=>e.jsx("option",{value:t.id,children:t.name},t.id))})]})]}),h?e.jsx(U,{student:h,allPoints:r.points,allUsers:r.users}):e.jsx(j,{children:e.jsxs("div",{className:"text-center py-12",children:[e.jsx(S,{className:"mx-auto h-12 w-12 text-text-secondary"}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-text-primary",children:"No Children Found"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"There are no students linked to your account. Please contact an administrator."})]})}),e.jsx(G,{})]})};export{X as default};
