const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/UserManagement-4cB-CaqB.js","assets/index-JBX9P6Qg.js","assets/index-Cu13L97R.css","assets/Modal-NYefmAjZ.js","assets/Select-BM0zQtf0.js","assets/StudentStatsDisplay-BBTp0fHw.js","assets/BadgeIconRenderer-BjlOxHvs.js","assets/validation-CkSfakBh.js","assets/helpers-snl2sRJ-.js","assets/useDebounce-CwzWEB2R.js","assets/ConfirmationModal-CPL5EhPs.js","assets/QuestManagement-zah6NXVu.js","assets/Table-DlSKKgO4.js","assets/SearchableSingleUserSelector-DWlEu3dp.js","assets/AuditLogViewer-xtI3bWMZ.js","assets/ActionPresetManagement-ClcRq45y.js","assets/TeacherReportViewer-B0aPMWHQ.js","assets/ClassManagement-Br-Fkqah.js","assets/roleUtils-D7XDrfnq.js","assets/AppealManagerWidget-CPmjAQh-.js","assets/BulkActionWidget-Doy8cHJn.js","assets/SystemHealthWidget-Dv1qHdLD.js","assets/UserRegistration-DkfBWNhN.js","assets/UnifiedAwardsManagement-DrtK2xZm.js"])))=>i.map(i=>d[i]);
import{j as e,F as C,c as N,h as I,r as t,G as R,B as A,v as E,H as S,b as P,f as k,u as M,J as U,A as T,R as L,e as O,q as D,U as V,K as $,x as Y,l as z,_ as g}from"./index-JBX9P6Qg.js";import{S as B}from"./Select-BM0zQtf0.js";const b=({title:s,value:n,icon:x,variant:u="default"})=>{const c={default:"text-primary",warning:"text-warning"};return e.jsxs("div",{className:"bg-surface rounded-xl shadow-sm border border-border p-4 h-full transition-all duration-300 ease-out hover:scale-105 hover:shadow-lg hover:-translate-y-1 cursor-pointer",children:[e.jsxs("div",{className:"flex items-center text-text-secondary",children:[e.jsx("div",{className:`mr-3 ${c[u]}`,children:C.cloneElement(x,{className:"h-6 w-6"})}),e.jsx("span",{className:"font-semibold text-sm",children:s})]}),e.jsx("p",{className:"text-4xl font-bold text-text-primary mt-2",children:n})]})},W=({points:s})=>{const[n,x]=t.useState(null),u=t.useMemo(()=>{const a={},d=new Date;for(let l=29;l>=0;l--){const i=new Date(d);i.setDate(d.getDate()-l);const v=i.toISOString().split("T")[0];a[v]={rewards:0,violations:0}}return s.forEach(l=>{const i=new Date(l.timestamp).toISOString().split("T")[0];a[i]&&(l.points>0?a[i].rewards+=l.points:a[i].violations+=Math.abs(l.points))}),Object.entries(a).map(([l,i])=>({date:new Date(l).toLocaleDateString("en-US",{month:"short",day:"numeric"}),...i}))},[s]),c=Math.max(...u.map(a=>Math.max(a.rewards,a.violations)),10),r=[0,Math.round(c/2),c],j=500,m=250,o={top:20,right:20,bottom:30,left:40},f=j-o.left-o.right,p=m-o.top-o.bottom;return e.jsxs("div",{className:"relative",children:[e.jsxs("svg",{viewBox:`0 0 ${j} ${m}`,className:"w-full h-auto",children:[r.map(a=>{const d=p-a/c*p;return e.jsxs("g",{transform:`translate(${o.left}, ${o.top})`,children:[e.jsx("text",{x:-10,y:d+4,textAnchor:"end",className:"text-xs fill-current text-text-secondary",children:a}),e.jsx("line",{x1:0,y1:d,x2:f,y2:d,className:"stroke-current text-border",strokeDasharray:"2,2"})]},a)}),e.jsx("g",{transform:`translate(${o.left}, ${o.top})`,children:u.map((a,d)=>{const l=f/u.length,i=4,v=d*l,h=a.rewards/c*p,w=a.violations/c*p;return e.jsxs("g",{onMouseMove:y=>{const _=y.currentTarget.getBoundingClientRect();x({x:y.clientX-_.left+10,y:y.clientY-_.top-10,data:a})},onMouseLeave:()=>x(null),children:[e.jsx("rect",{x:v+i/2,y:p-h,width:l/2-i/2,height:h,className:"fill-current text-secondary"}),e.jsx("rect",{x:v+l/2,y:p-w,width:l/2-i/2,height:w,className:"fill-current text-danger"}),u.length<=30&&d%4===0&&e.jsx("text",{x:v+l/2,y:p+15,textAnchor:"middle",className:"text-xs fill-current text-text-secondary",children:a.date})]},a.date)})})]}),n&&e.jsxs("div",{className:"absolute bg-slate-800 text-white text-xs rounded-md p-2 pointer-events-none shadow-lg",style:{left:n.x,top:n.y,transform:"translateY(-100%)"},children:[e.jsx("p",{className:"font-bold",children:n.data.date}),e.jsxs("p",{children:[e.jsxs("span",{className:"text-secondary font-semibold",children:["+",n.data.rewards]})," Rewards"]}),e.jsxs("p",{children:[e.jsxs("span",{className:"text-danger font-semibold",children:["-",n.data.violations]})," Violations"]})]})]})},q=({points:s})=>e.jsxs(N,{title:"Last 30 Days Activity",icon:e.jsx(I,{className:"h-5 w-5"}),children:[e.jsx(W,{points:s}),e.jsxs("div",{className:"flex flex-wrap justify-center items-center gap-x-4 gap-y-1 mt-2 text-xs text-text-secondary",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"h-3 w-3 rounded-sm bg-secondary mr-1.5"}),e.jsx("span",{children:"Rewards"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("span",{className:"h-3 w-3 rounded-sm bg-danger mr-1.5"}),e.jsx("span",{children:"Violations"})]})]})]}),H=({pendingReports:s,pendingAppeals:n})=>{const x=s>0||n>0;return e.jsx(N,{title:"Needs Attention",icon:e.jsx(S,{className:"h-5 w-5"}),children:e.jsx("div",{className:"space-y-4",children:x?e.jsxs(e.Fragment,{children:[s>0&&e.jsxs("div",{className:"flex justify-between items-center bg-amber-50 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-text-primary flex items-center",children:[e.jsx(R,{className:"h-4 w-4 mr-2 text-amber-600"}),"New Teacher Reports"]}),e.jsxs("p",{className:"text-sm text-amber-700",children:[s," report(s) to review."]})]}),e.jsx("a",{href:"#teacher-reports",children:e.jsx(A,{size:"sm",variant:"secondary",className:"bg-amber-200 text-amber-800 hover:bg-amber-300",children:"Review"})})]}),n>0&&e.jsxs("div",{className:"flex justify-between items-center bg-slate-50 dark:bg-slate-800 p-3 rounded-lg",children:[e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-text-primary flex items-center",children:[e.jsx(E,{className:"h-4 w-4 mr-2 text-slate-600 dark:text-slate-400"}),"New Student Appeals"]}),e.jsxs("p",{className:"text-sm text-slate-700 dark:text-slate-300",children:[n," appeal(s) to review."]})]}),e.jsx("a",{href:"#appeal-manager",children:e.jsx(A,{size:"sm",variant:"secondary",className:"bg-slate-200 dark:bg-slate-600 text-slate-800 dark:text-slate-200 hover:bg-slate-300 dark:hover:bg-slate-500",children:"Review"})})]})]}):e.jsxs("div",{className:"text-center py-8",children:[e.jsx("div",{className:"mx-auto h-12 w-12 flex items-center justify-center rounded-full bg-green-100",children:e.jsx(S,{className:"h-6 w-6 text-green-600"})}),e.jsx("h3",{className:"mt-2 text-lg font-medium text-text-primary",children:"All Clear!"}),e.jsx("p",{className:"mt-1 text-sm text-text-secondary",children:"No items need your immediate attention."})]})})})},oe=({children:s,title:n,description:x,icon:u,actions:c,className:r="",variant:j="default"})=>e.jsxs(N,{variant:j,padding:"none",className:r,children:[(n||x||c)&&e.jsx("div",{className:"px-4 sm:px-6 py-4 border-b border-border bg-blue-50/50",children:e.jsxs("div",{className:"flex flex-col sm:flex-row sm:justify-between sm:items-start gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3 sm:gap-4",children:[u&&e.jsx("div",{className:"text-primary flex-shrink-0",children:u}),e.jsxs("div",{children:[n&&e.jsx("h3",{className:"text-lg sm:text-xl font-semibold text-text-primary",children:n}),x&&e.jsx("p",{className:"text-sm text-text-secondary mt-1",children:x})]})]}),c&&e.jsx("div",{className:"flex items-center gap-2 w-full sm:w-auto",children:c})]})}),e.jsx("div",{className:"p-4 sm:p-6",children:s})]}),F=({children:s,className:n=""})=>e.jsx("div",{className:`grid grid-cols-2 md:grid-cols-4 lg:grid-cols-6 gap-4 ${n}`,children:s}),Q={start:"justify-start",center:"justify-center",end:"justify-end",between:"justify-between"},xe=({children:s,className:n="",justify:x="between",mobileStack:u=!1})=>{const c=u?"flex flex-col sm:flex-row items-stretch sm:items-center gap-3 sm:gap-4":"flex flex-wrap items-center gap-3 sm:gap-4";return e.jsx("div",{className:`${c} ${Q[x]} ${n}`,children:s})},G=()=>{const{availableYears:s,selectedYear:n,setSelectedYear:x}=P(),u=()=>{const m=new Date,o=m.getFullYear();return m.getMonth()>=6?`${o}/${o+1}`:`${o-1}/${o}`},c=t.useMemo(()=>{const m=u(),o=new Set([m,...s]);return Array.from(o).sort((f,p)=>p.localeCompare(f))},[s]),r=m=>{x(m.target.value)};if(c.length<=1)return null;const j=u();return e.jsxs("div",{className:"flex items-center space-x-2 bg-slate-100 p-2 rounded-lg border border-border",children:[e.jsx(k,{className:"h-5 w-5 text-text-secondary"}),e.jsxs(B,{value:n,onChange:r,className:"!border-none !shadow-none !ring-0 bg-transparent text-text-primary font-semibold","aria-label":"Select academic year",children:[e.jsxs("option",{value:"current",children:[j," (Current)"]},"current"),c.filter(m=>m!==j).map(m=>e.jsx("option",{value:m,children:m},m))]})]})},K=t.lazy(()=>g(()=>import("./UserManagement-4cB-CaqB.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10]))),J=t.lazy(()=>g(()=>import("./QuestManagement-zah6NXVu.js"),__vite__mapDeps([11,1,2,12,3,4,13,8,9,6,10]))),X=t.lazy(()=>g(()=>import("./AuditLogViewer-xtI3bWMZ.js"),__vite__mapDeps([14,1,2])).then(s=>({default:s.AuditLogViewer}))),Z=t.lazy(()=>g(()=>import("./ActionPresetManagement-ClcRq45y.js"),__vite__mapDeps([15,1,2,3,12,4,6,10]))),ee=t.lazy(()=>g(()=>import("./TeacherReportViewer-B0aPMWHQ.js"),__vite__mapDeps([16,1,2,10,3,8])).then(s=>({default:s.TeacherReportViewer}))),se=t.lazy(()=>g(()=>import("./ClassManagement-Br-Fkqah.js"),__vite__mapDeps([17,1,2,12,3,13,8,9,10,18,4])).then(s=>({default:s.ClassManagement}))),te=t.lazy(()=>g(()=>import("./AppealManagerWidget-CPmjAQh-.js"),__vite__mapDeps([19,1,2,8,10,3])).then(s=>({default:s.AppealManagerWidget}))),ae=t.lazy(()=>g(()=>import("./BulkActionWidget-Doy8cHJn.js"),__vite__mapDeps([20,1,2,4])).then(s=>({default:s.BulkActionWidget}))),re=t.lazy(()=>g(()=>import("./SystemHealthWidget-Dv1qHdLD.js"),__vite__mapDeps([21,1,2])).then(s=>({default:s.SystemHealthWidget}))),ne=t.lazy(()=>g(()=>import("./UserRegistration-DkfBWNhN.js"),__vite__mapDeps([22,1,2,4,7,8,9]))),le=t.lazy(()=>g(()=>import("./UnifiedAwardsManagement-DrtK2xZm.js"),__vite__mapDeps([23,1,2,4,3,13,8,9]))),ie=()=>{const{user:s}=M(),{isViewingPastYear:n,selectedYear:x,refetchSharedData:u,classes:c}=P(),[r,j]=t.useState(null),[m,o]=t.useState(!0),[f,p]=t.useState(null),a=t.useCallback(async()=>{var i,v;o(!0),p(null);try{const h=await U({year:x});console.log("AdminDashboard - API result:",{hasResult:!!h,hasUsers:!!(h!=null&&h.users),usersLength:((i=h==null?void 0:h.users)==null?void 0:i.length)||0,sampleUser:((v=h==null?void 0:h.users)==null?void 0:v[0])||"No users",resultKeys:Object.keys(h||{})}),j(h)}catch(h){p("Failed to load admin dashboard data."),console.error("AdminDashboard - API error:",h)}finally{o(!1)}},[x]);t.useEffect(()=>{s&&a()},[s,a]);const d=t.useMemo(()=>r?{totalUsers:r.users.length,pendingReports:r.teacherReports.filter(i=>i.status===L.NEW).length,activeQuests:r.quests.filter(i=>i.isActive).length,totalPresets:r.actionPresets.filter(i=>!i.isArchived).length,totalClasses:r.classes.length,pendingAppeals:r.appeals.filter(i=>i.status===T.PENDING).length}:{totalUsers:0,pendingReports:0,activeQuests:0,totalPresets:0,totalClasses:0,pendingAppeals:0},[r]);if(m)return e.jsx(O,{});if(f)return e.jsx("div",{className:"text-center text-danger p-8",children:f});if(!s||!r)return null;const l=n?"pointer-events-none opacity-60":"";return e.jsxs("div",{className:"space-y-6",children:[s.role===D.SUPER_SECRET_ADMIN&&e.jsx("div",{className:"p-4 bg-red-100 border-l-4 border-danger rounded-r-lg",children:e.jsx("p",{className:"font-bold text-red-800",children:"SUPER SECRET ADMIN MODE: Actions are not being audited."})}),e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4",children:[e.jsx("h1",{className:"text-3xl font-bold text-text-primary",children:"Admin Command Center"}),e.jsx(G,{})]}),e.jsxs(F,{children:[e.jsx(b,{title:"Total Users",value:d.totalUsers,icon:e.jsx(V,{})}),e.jsx(b,{title:"Total Classes",value:d.totalClasses,icon:e.jsx($,{})}),e.jsx(b,{title:"Active Quests",value:d.activeQuests,icon:e.jsx(Y,{})}),e.jsx(b,{title:"Action Presets",value:d.totalPresets,icon:e.jsx(z,{})}),e.jsx(b,{title:"Pending Reports",value:d.pendingReports,icon:e.jsx(R,{}),variant:d.pendingReports>0?"warning":"default"}),e.jsx(b,{title:"Pending Appeals",value:d.pendingAppeals,icon:e.jsx(E,{}),variant:d.pendingAppeals>0?"warning":"default"})]}),e.jsx("div",{id:"system-health",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-24 rounded-lg"}),children:e.jsx(re,{})})}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2",children:e.jsx(q,{points:r.points})}),e.jsx(H,{pendingReports:d.pendingReports,pendingAppeals:d.pendingAppeals})]}),e.jsxs("div",{className:"grid grid-cols-1 gap-6",children:[n&&e.jsx("div",{className:"p-4 bg-amber-100 border-l-4 border-amber-500 rounded-r-lg",children:e.jsx("p",{className:"font-bold text-amber-800",children:"You are viewing a past academic year. All management actions are disabled."})}),e.jsx("div",{id:"bulk-actions",className:l,children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-32 rounded-lg"}),children:e.jsx(ae,{onUpdate:a})})}),e.jsx("div",{id:"user-registration",className:l,children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(ne,{users:r.users,classes:c,onUpdate:a})})}),e.jsx("div",{id:"user-management",className:l,children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(K,{users:r.users,classes:c,points:r.points,onUpdate:a})})}),e.jsx("div",{id:"class-management",className:l,children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-48 rounded-lg"}),children:e.jsx(se,{onUpdate:u})})}),e.jsxs("div",{className:`grid grid-cols-1 lg:grid-cols-2 gap-6 ${l}`,children:[e.jsx("div",{id:"quest-management",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(J,{quests:r.quests,questParticipants:r.questParticipants,users:r.users,onUpdate:a})})}),e.jsx("div",{id:"preset-management",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(Z,{onUpdate:a})})})]}),e.jsx("div",{id:"awards-management",className:l,children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(le,{onUpdate:a})})}),e.jsx("div",{id:"appeal-manager",className:l,children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(te,{appeals:r.appeals,users:r.users,points:r.points,onUpdate:a})})}),e.jsx("div",{id:"teacher-reports",className:l,children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(ee,{reports:r.teacherReports,users:r.users,onUpdate:a})})}),s.role===D.ADMIN&&e.jsx("div",{id:"audit-log",children:e.jsx(t.Suspense,{fallback:e.jsx("div",{className:"animate-pulse bg-gray-200 h-64 rounded-lg"}),children:e.jsx(X,{logs:r.auditLogs})})})]})]})},me=Object.freeze(Object.defineProperty({__proto__:null,default:ie},Symbol.toStringTag,{value:"Module"}));export{oe as A,xe as a,me as b};
