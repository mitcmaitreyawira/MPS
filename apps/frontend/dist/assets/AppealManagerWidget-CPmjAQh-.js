import{b as y,r as o,A as a,j as e,c as A,v as w,B as h,w as C,a6 as D,a as E}from"./index-JBX9P6Qg.js";import{g as I,a as P}from"./helpers-snl2sRJ-.js";import{C as S}from"./ConfirmationModal-CPL5EhPs.js";import"./Modal-NYefmAjZ.js";const L=({status:s})=>{const l={[a.PENDING]:"bg-amber-100 text-amber-800",[a.APPROVED]:"bg-green-100 text-green-800",[a.REJECTED]:"bg-red-100 text-red-800"};return e.jsx("span",{className:`px-2 inline-flex text-xs leading-5 font-semibold rounded-full capitalize ${l[s]}`,children:s})},R=({appeal:s,onReview:l})=>{var c;const[d,u]=o.useState(!1);return e.jsxs("div",{className:"bg-slate-50 border border-border rounded-lg",children:[e.jsxs("div",{className:"p-4 flex flex-col sm:flex-row sm:justify-between sm:items-center gap-3",children:[e.jsxs("div",{className:"flex items-center space-x-3 flex-grow",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-sm ${P(s.student.name)}`,children:I(s.student.name)}),e.jsxs("div",{children:[e.jsx("p",{className:"font-semibold text-text-primary",children:s.student.name}),e.jsxs("p",{className:"text-xs text-text-secondary",children:["Submitted: ",new Date(s.submittedAt).toLocaleDateString()]})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(L,{status:s.status}),e.jsx("button",{type:"button",onClick:()=>u(!d),className:"p-1 rounded-full text-text-secondary hover:bg-slate-200",children:e.jsx(C,{className:`h-5 w-5 transition-transform ${d?"rotate-180":""}`})})]})]}),d&&e.jsxs("div",{className:"p-4 border-t border-border space-y-4 animate-fade-in-up",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-text-primary text-xs mb-1",children:"Student's Reason:"}),e.jsxs("p",{className:"text-text-primary my-1 p-3 bg-white border-l-4 border-slate-300 rounded text-sm",children:['"',s.reason,'"']})]}),e.jsxs("div",{children:[e.jsx("h5",{className:"font-semibold text-text-primary text-xs mb-1",children:"Original Log Details:"}),e.jsxs("div",{className:"p-3 bg-white border rounded-md text-sm space-y-1",children:[e.jsxs("p",{children:[e.jsx("strong",{children:"Description:"})," ",s.originalLog.description]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Points:"})," ",e.jsx("span",{className:"font-bold text-danger",children:s.originalLog.points})]})]})]}),s.status===a.PENDING?e.jsxs("div",{className:"flex justify-end space-x-2 pt-2",children:[e.jsxs(h,{size:"sm",variant:"danger",onClick:()=>l(s,a.REJECTED),children:[e.jsx(D,{className:"h-4 w-4 mr-1.5"}),"Reject"]}),e.jsxs(h,{size:"sm",variant:"secondary",onClick:()=>l(s,a.APPROVED),children:[e.jsx(E,{className:"h-4 w-4 mr-1.5"}),"Approve"]})]}):e.jsx("div",{className:"pt-3 border-t border-dashed",children:e.jsxs("p",{className:"text-xs text-text-secondary",children:["Reviewed by ",e.jsx("span",{className:"font-medium text-text-primary",children:((c=s.reviewer)==null?void 0:c.name)||"N/A"})," on ",s.reviewedAt?new Date(s.reviewedAt).toLocaleDateString():"N/A","."]})})]})]})},O=({appeals:s,users:l,points:d,onUpdate:u})=>{const{reviewAppeal:c}=y(),[x,f]=o.useState(a.PENDING),[r,p]=o.useState(null),i=o.useMemo(()=>s.map(t=>({...t,student:l.find(n=>n.id===t.studentId),originalLog:d.find(n=>n.id===t.pointLogId),reviewer:t.reviewedBy?l.find(n=>n.id===t.reviewedBy):void 0})).filter(t=>!!(t.student&&t.originalLog)).sort((t,n)=>new Date(n.submittedAt).getTime()-new Date(t.submittedAt).getTime()),[s,l,d]),j=o.useMemo(()=>x==="all"?i:i.filter(t=>t.status===x),[x,i]),g=(t,n)=>{p({appeal:t,status:n})},b=async()=>{if(!r)return;const{appeal:t,status:n}=r;await c(t.id,n),u(),p(null)},m=({status:t,label:n,count:N})=>{const v=x===t;return e.jsxs(h,{size:"sm",onClick:()=>f(t),variant:v?"primary":"neutral",children:[n," (",N,")"]})};return e.jsxs(e.Fragment,{children:[e.jsxs(A,{children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between sm:items-center mb-4 gap-4",children:[e.jsxs("h3",{className:"text-xl font-semibold text-text-primary flex items-center gap-3",children:[e.jsx(w,{className:"h-6 w-6"}),"Student Appeal Manager"]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(m,{status:a.PENDING,label:"Pending",count:i.filter(t=>t.status==="pending").length}),e.jsx(m,{status:a.APPROVED,label:"Approved",count:i.filter(t=>t.status==="approved").length}),e.jsx(m,{status:a.REJECTED,label:"Rejected",count:i.filter(t=>t.status==="rejected").length}),e.jsx(m,{status:"all",label:"All",count:i.length})]})]}),e.jsx("div",{className:"max-h-[32rem] overflow-y-auto pr-2 space-y-3",children:j.length>0?j.map(t=>e.jsx(R,{appeal:t,onReview:g},t.id)):e.jsx("p",{className:"text-text-secondary text-center py-12",children:"No appeals match the current filter."})})]}),e.jsx(S,{isOpen:!!r,onClose:()=>p(null),onConfirm:b,title:`Confirm Appeal ${(r==null?void 0:r.status)==="approved"?"Approval":"Rejection"}`,message:e.jsxs("p",{children:["Are you sure you want to ",e.jsx("strong",{children:r==null?void 0:r.status})," this appeal from ",e.jsx("strong",{children:r==null?void 0:r.appeal.student.name}),"?"]}),confirmText:`Yes, ${(r==null?void 0:r.status)==="approved"?"Approve":"Reject"}`,confirmVariant:(r==null?void 0:r.status)==="approved"?"secondary":"danger"})]})};export{O as AppealManagerWidget};
