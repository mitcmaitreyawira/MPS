import{F as G,r as a,ah as R,j as n,W,I as X,a6 as _,w as H}from"./index-JBX9P6Qg.js";import{g as z,a as O}from"./helpers-snl2sRJ-.js";import{u as J}from"./useDebounce-CwzWEB2R.js";const Q=G.memo(({users:d=[],selectedUserId:o,onSelectUser:y,placeholder:T="Search and select a user...",required:U=!1,useDatabase:r=!1,roleFilter:c,classFilter:i})=>{const[j,N]=a.useState(""),[u,m]=a.useState(!1),[x,p]=a.useState(!1),[f,k]=a.useState([]),[D,S]=a.useState(!1),[s,v]=a.useState(null),b=a.useRef(null),l=J(j,300);a.useEffect(()=>{if(o){const e=d.find(t=>t.id===o)||f.find(t=>t.id===o);e?v(e):r&&o&&M(o)}else v(null)},[o,d,f,r]);const C=a.useCallback(e=>{b.current&&!b.current.contains(e.target)&&m(!1)},[]);a.useEffect(()=>(document.addEventListener("mousedown",C),()=>{document.removeEventListener("mousedown",C)}),[C]);const M=a.useCallback(async e=>{try{const g=(await R({search:"",limit:1,page:1,...c&&{role:c},...i&&{classId:i}})).users.find(w=>w.id===e);g&&v(g)}catch(t){console.error("Error fetching user by ID:",t)}},[c,i]),h=a.useCallback(async e=>{if(r){S(!0);try{const t=await R({search:e,limit:50,page:1,...c&&{role:c},...i&&{classId:i}});k(t.users)}catch(t){console.error("Error searching users:",t),k([])}finally{S(!1)}}},[r,c,i]);a.useEffect(()=>{r&&l&&u?h(l):r&&!l&&u&&h("")},[l,r,u,h]);const $=a.useMemo(()=>{if(r)return f;if(!l)return d;const e=l.toLowerCase();return d.filter(t=>{var g,w,E,I,P;return((g=t.name)==null?void 0:g.toLowerCase().includes(e))||((w=t.username)==null?void 0:w.toLowerCase().includes(e))||((E=t.firstName)==null?void 0:E.toLowerCase().includes(e))||((I=t.lastName)==null?void 0:I.toLowerCase().includes(e))||((P=t.email)==null?void 0:P.toLowerCase().includes(e))||t.nisn&&t.nisn.toLowerCase().includes(e)})},[r,f,d,l]),L=a.useCallback(e=>{y(e.id),m(!1),N(""),p(!1)},[y]),K=a.useCallback(e=>{N(e.target.value),p(!0),m(t=>t||!0)},[]),q=a.useCallback(()=>{m(!0),p(!0),r&&f.length===0&&h("")},[r,f.length,h]),A=a.useCallback(()=>{m(e=>(e||(p(!1),N("")),!e))},[]),B=a.useCallback(()=>{y(""),N(""),p(!1),m(!1)},[y]);return n.jsxs("div",{className:"relative",ref:b,children:[n.jsxs("div",{className:"relative",children:[s?n.jsx("div",{className:`absolute top-1/2 left-3 -translate-y-1/2 pointer-events-none z-10 w-5 h-5 rounded-full flex items-center justify-center text-xs font-bold ${O(s.name||"Unknown")}`,children:z(s.name||"Unknown")}):n.jsx(W,{className:"h-5 w-5 text-text-secondary absolute top-1/2 left-3 -translate-y-1/2 pointer-events-none z-10"}),n.jsx(X,{type:"text",placeholder:s&&!x?s.name||`${s.firstName} ${s.lastName}`:T,value:x?j:s?s.name||`${s.firstName} ${s.lastName}`:"",onChange:K,onFocus:q,onKeyDown:e=>{e.key==="Enter"&&(e.preventDefault(),e.stopPropagation())},required:U&&!o,autoComplete:"off",className:`pl-10 ${s&&!x?"text-text-primary font-medium":""}`,readOnly:s&&!x}),n.jsxs("div",{className:"absolute inset-y-0 right-0 flex items-center",children:[s&&!x&&n.jsx("button",{type:"button",className:"flex items-center px-2 text-text-secondary hover:text-text-primary transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation(),B()},title:"Clear selection",children:n.jsx(_,{className:"h-4 w-4"})}),n.jsx("button",{type:"button",className:"flex items-center px-2 text-text-secondary hover:text-text-primary transition-colors",onClick:e=>{e.preventDefault(),e.stopPropagation(),A()},children:n.jsx(H,{className:`h-5 w-5 transition-transform ${u?"rotate-180":""}`})})]})]}),u&&n.jsx("ul",{className:"absolute z-20 w-full mt-1 bg-surface border border-border rounded-lg shadow-lg max-h-60 overflow-y-auto animate-fade-in-up",children:D?n.jsx("li",{className:"p-3 text-sm text-center text-text-secondary",children:n.jsxs("div",{className:"flex items-center justify-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 border-2 border-primary border-t-transparent rounded-full animate-spin"}),"Searching..."]})}):$.length>0?$.map(e=>n.jsx("li",{children:n.jsxs("button",{type:"button",className:`w-full flex items-center p-3 text-left cursor-pointer hover:bg-slate-100 ${o===e.id?"bg-primary/10":""} border-none bg-transparent`,onMouseDown:t=>{t.preventDefault(),t.stopPropagation()},onClick:t=>{t.preventDefault(),t.stopPropagation(),L(e)},onKeyDown:t=>{(t.key==="Enter"||t.key===" ")&&(t.preventDefault(),t.stopPropagation(),L(e))},children:[n.jsx("div",{className:`w-9 h-9 rounded-full flex-shrink-0 flex items-center justify-center font-bold text-sm mr-3 ${O(e.name||`${e.firstName} ${e.lastName}`||"Unknown")}`,children:z(e.name||`${e.firstName} ${e.lastName}`||"Unknown")}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"font-medium text-text-primary truncate",children:e.name||`${e.firstName} ${e.lastName}`||"Unknown User"}),n.jsxs("div",{className:"flex items-center gap-2 text-xs text-text-secondary",children:[e.username&&n.jsxs("span",{className:"bg-slate-100 px-2 py-0.5 rounded",children:["@",e.username]}),n.jsx("span",{className:"capitalize",children:e.className||(e.role?e.role.replace(/_/g," "):"No role")})]}),e.email&&n.jsx("p",{className:"text-xs text-text-secondary/70 truncate mt-0.5",children:e.email})]})]})},e.id)):n.jsx("li",{className:"p-3 text-sm text-center text-text-secondary",children:r&&j?"No users found matching your search.":"No users found."})})]})});Q.displayName="SearchableSingleUserSelector";export{Q as S};
